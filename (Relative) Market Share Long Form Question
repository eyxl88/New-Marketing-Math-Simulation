print(f"Welcome to Long Answer Market Share and Market Size\n")

global completion

import random

class CompanyInfo:

    def __init__(self, lower_sales_units, upper_sales_units, price_lower, price_higher):
        self.sales_units = random.randint(lower_sales_units, upper_sales_units)
        self.selling_price = random.randint(price_lower, price_higher)
        self.sales_dollars = self.sales_units * self.selling_price

my_company = CompanyInfo(50000, 100000, 2, 10)
lead_competition = CompanyInfo(200000, 400000, 6, 18)
competitor = CompanyInfo(8000, 20000, 2, 10)

# Useful Randomized Sign Function
def random_sign(value):
    plus_minus = random.randint(0,1)
    if plus_minus == 0:
        value = -value
    return value

change_in_sales = random_sign(random.randint(1000, 100000))

class TotalInfo:
    def __init__(self):
        self.sales_units = my_company.sales_units + lead_competition.sales_units + competitor.sales_units
        self.sales_dollars = my_company.sales_dollars + lead_competition.sales_dollars + competitor.sales_dollars
        self.last_year_sales = self.sales_dollars + change_in_sales
        self.market_growth_rate = ((self.sales_dollars - last_year_sales) / last_year_sales) * 100

total = TotalInfo()

class Segment:
    def __init__(self, percent):
        self.percent = percent
        self.dollars = self.percent * total.sales_dollars

segment_a = Segment(random.randint(50,99))
segment_b = Segment(100 - segment_a.percent)

class ProblemAnswers:
    def __init__(self, class_name, chosen_segment=segment_a):
        self.rel_ms = class_name.sales_dollars / lead_competition.sales_dollars * 100
        self.ms_dollars = class_name.sales_dollars / total.sales_dollars * 100
        self.ms_units = class_name.sales_units / total.sales_units * 100
        self.ms_seg = class_name.sales_dollars / chosen_segment.dollars * 100

my_answers = ProblemAnswers(my_company)
competitor_answers = ProblemAnswers(competitor)
lead_answers = ProblemAnswers(lead_competition)

# Relative Market Share # Didn't change because I'm just cleaning up back end code.
print(f"Company:\t\tSales in dollars ($)")
print("_" * 50)
print(f"You:\t\t\t${my_company.sales_dollars:,d}")
print(f"Company B:\t\t${competitor.sales_dollars:,d}")
print(f"Lead Competitor:\t${lead_competition.sales_dollars:,d}")

# Create appropriate exception classes for common input errors.
class CommaError(Exception):
    def __init__(self, value):
        self.value = value
class DollarSignError(Exception):
    def __init__(self, value):
        self.value = value
class PercentError(Exception):
    def __init__(self, value):
        self.value = value

# General function to safely handle user input so the program does not break so easily.
def get_user_input(print_message, float_or_int):
    print(print_message, end="")
    user_input = input()
    while user_input != "give up":
        try:
            if "," in user_input:
                raise CommaError("Invalid input. Do not enter the , sign")
            if "%" in user_input:
                raise PercentError("Invalid input. Do not enter the % sign.")
            if "$" in user_input:
                raise DollarSignError("Invalid Input. Do not enter the $ sign.")
            user_input = float_or_int(user_input)
            return user_input
            break

        except CommaError as excpt:
              print(excpt)
              user_input = input()
        except PercentError as excpt:
              print(excpt)
              user_input = input()
        except DollarSignError as excpt:
              print(excpt)
              user_input = input()
        except:
              print("Invalid Entry.")
              user_input = input()
    if user_input == "give up":
        return "give up"

# General class to group and print answer messages as created by instances.
class AnswerMessages:
    company_class = None
    ans_class = None
    company_name = None
    def __init__(self):
        self.correct = None
        self.input_precursor = ""
        self.try_again = "Try again or enter \"give up\" to show the answer: {self.input_precursor}"
        self.wrong = None
    def print_msg(self, msg):
        if msg == 1:
            print(self.correct)
        if msg == 2:
            print(self.try_again)
        if msg == 3:
            print()
            print(self.wrong)

# Functions to check float and int values.

def check_float_value(user_val, value_to_check, instance_name):
    global completion
    value_low = value_to_check - 0.005
    value_high = value_to_check + 0.005
    if user_val == "give up":
        instance_name.print_msg(3)
        completion = True
    elif value_low < user_val < value_high:
        instance_name.print_msg(1)
        completion = True
    else:
        instance_name.print_msg(2)

def check_exact_value(user_val, value_to_check, instance_name):
    if user_val == "give up":
        instance_name.print_msg(3)
        completion = True
    elif user_val == value_to_check
        instance_name.print_msg(1)
        completion = True
    else:
        instance_name.print_msg(2)

# Missing Value Market Share and Size

class LongQuestion:
    def __init__(self):
        self.count = 0
        self.sales_type = ""
        self.question_type = None # ASSIGN THIS OUTSIDE
        # self.middle_top, self.middle_middle, self.middle_bottom, self.right_top, self.right_middle, self.right_bottom = "","","","","",
        construction_list = [[my_company, competitor, lead_competition], [my_answers, competitor_answers, lead_competition_answers]]
    def __assign_answer_vals(self):
        if self.question_type == "units":
            value_list = i.sales_units for i in construction_list[0]
            value_list.extend(i.ms_units for i in construction_list[1])
            self.middle_top, self.middle_middle, self.middle_bottom, self.right_top, self.right_middle, self.right_bottom = tuple(value_list)
            
    def print_question_header(self):
        if count == 4:
            print()
            print("Completed version of the question:")
        elif count > 0:
            print()
            print("Updated version of the question:")
    def print_table_header(self):
        print()
        print(f"Company:\t\t{sales_type}\tMarket Share %")
        print("_" * 50)
    def print_question(self): # Fix this up later
        self.print_question_header()
        self.print_table_header()
        print(f"Your Company:\t\t{my_company.sales_units}\t\t{my_answers.ms_units}")
        print(f"Company B:\t\t{competitor.sales_units}\t\t??")
        print(f"Lead Competitor:\t{lead_competition_sales_units}\t\t??")
        print(f"Market Size (units):\t??\t\t100%")

# Set Up Answer Messages for Market Size Question
market_size_units = AnswerMessages()
market_size_units.correct = f"Correct. The market size in units is {market_size_units} units.\n"
market_size_units.wrong = f"The correct market size in units was {market_size_units} units.\n" \
            f"Add Your Company's sales in units to Company B's sales in Units to the Lead Competitor's sales in units.\n" \
            f"In this case, that will be {my_company.sales_units} + {competitor.sales_units} * {lead_competition.sales_units}.\n"

REVISIONS CURRENTLY HERE
print()
count = 0
print_long_question(count)
print("Assume only you, company B, and the lead competitor are in this industry.")
completion = False
while completion == False:
    user_market_size_units = get_user_input("Enter the total market size in units here: ", int)
    check_exact_value(user_market_size_units, total.market_size_units, market_size_units)

print()
print("Updated version of the question:")
print()
print(f"Company:\t\tSales (units)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t{my_sales_units}\t\t??")
print(f"Company B:\t\t{competitor_sales_units}\t\t??")
print(f"Lead Competitor:\t{lead_competition_sales_units}\t\t??")
print(f"Market Size (units):\t{market_size_units}\t\t100%")

# Finding Your Market Share in Units
print()
user_my_ms_units = float(input("Enter YOUR company's market share in units as a percentage up to 2 decimal places: "))

my_ms_units_low = my_ms_units - 0.005
my_ms_units_high = my_ms_units + 0.005

if my_ms_units_low < user_my_ms_units < my_ms_units_high:
    print(f"Correct! Your Company's Market Share is {my_ms_units:.3f}% (3 decimal places for reference).")
else:
    print("Try again.")
    user_my_ms_units = float(input())
    if my_ms_units_low < user_my_ms_units < my_ms_units_high:
         print(f"Correct! Your Company's Market Share is {my_ms_units:.3f}% (3 decimal places for reference).")
    else:
         print("Try again. Last try.")
         user_my_ms_units = float(input())
         if my_ms_units_low < user_my_ms_units < my_ms_units_high:
              print(f"Correct! Your Company's Market Share is {my_ms_units:.3f}% (3 decimal places for reference).")
         else:
              print(f"The correct Market Share in units for Your Company was {my_ms_units:.3f}% rounded up or down as necessary.")
              print(f"The Market Share of Your Company is your sales in units divided by total sales in units.")
              print(f"In this case, that is {my_sales_units} / {market_size_units} * 100 to convert to a percent.")

print()
print("Updated version of the question:")
print()
print(f"Company:\t\tSales (units)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t{my_sales_units}\t\t{my_ms_units:.3f}%")
print(f"Company B:\t\t{competitor_sales_units}\t\t??")
print(f"Lead Competitor:\t{lead_competition_sales_units}\t\t??")
print(f"Market Size (units):\t{market_size_units}\t\t100%")

# Company B Market Share

print()
user_competitor_ms_units = float(input("Enter Company B's market share in units as a percentage up to 2 decimal places: "))

competitor_ms_units_low = competitor_ms_units - 0.005
competitor_ms_units_high = competitor_ms_units + 0.005

if competitor_ms_units_low < user_competitor_ms_units < competitor_ms_units_high:
    print(f"Correct! Company B's Market Share is {competitor_ms_units:.3f}% (3 decimal places for reference).")
else:
    print("Try again.")
    user_competitor_ms_units = float(input())
    if competitor_ms_units_low < user_competitor_ms_units < competitor_ms_units_high:
         print(f"Correct! Company B's Market Share is {competitor_ms_units:.3f}% (3 decimal places for reference).")
    else:
         print("Try again. Last try.")
         user_competitor_ms_units = float(input())
         if competitor_ms_units_low < user_competitor_ms_units < competitor_ms_units_high:
              print(f"Correct! Company B's Market Share is {competitor_ms_units:.3f}% (3 decimal places for reference).")
         else:
              print(f"The correct Market Share in units for Company B was {competitor_ms_units:.3f}% rounded up or down as necessary.")
              print(f"The Market Share of Company B is Company B's sales in units divided by total sales in units.")
              print(f"In this case, that is {competitor_sales_units} / {market_size_units} * 100 to convert to a percent.")

print()
print("Updated version of the question:")
print()
print(f"Company:\t\tSales (units)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t{my_sales_units}\t\t{my_ms_units:.3f}%")
print(f"Company B:\t\t{competitor_sales_units}\t\t{competitor_ms_units:.3f}%")
print(f"Lead Competitor:\t{lead_competition_sales_units}\t\t??")
print(f"Market Size (units):\t{market_size_units}\t\t100%")

# Lead Competitor Market Share

print()
user_lead_ms_units = float(input("Enter the Lead Competitor's market share in units as a percentage up to 2 decimal places: "))

lead_ms_units_low = lead_ms_units - 0.005
lead_ms_units_high = lead_ms_units + 0.005

if lead_ms_units_low < user_lead_ms_units < lead_ms_units_high:
    print(f"Correct! The Lead Competitor's Market Share is {lead_ms_units_units:.3f}% (3 decimal places for reference).")
else:
    print("Try again.")
    user_lead_ms_units = float(input())
    if lead_ms_units_low < user_lead_ms_units < lead_ms_units_high:
         print(f"Correct! The Lead Competitor's Market Share is {lead_ms_units_units:.3f}% (3 decimal places for reference).")
    else:
         print("Try again. Last try.")
         user_lead_ms_units = float(input())
         if lead_ms_units_low < user_lead_ms_units < lead_ms_units_high:
              print(f"Correct! The Lead Competitor's Market Share is {lead_ms_units_units:.3f}% (3 decimal places for reference).")
         else:
              print(f"The correct Market Share in units for the Lead Competitor was {lead_ms_units:.3f}% rounded up or down as necessary.")
              print(f"The Market Share of the Lead Competitor is the Lead Competitor's sales in units divided by total sales in units.")
              print(f"In this case, that is {lead_competition_sales_units} / {market_size_units} * 100 to convert to a percent.")

print()
print("Completed version of the question:")
print()
print(f"Company:\t\tSales (units)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t{my_sales_units}\t\t{my_ms_units:.3f}%")
print(f"Company B:\t\t{competitor_sales_units}\t\t{competitor_ms_units:.3f}%")
print(f"Lead Competitor:\t{lead_competition_sales_units}\t\t{lead_ms_units:.3f}%")
print(f"Market Size (units):\t{market_size_units}\t\t100%")
print("Good job!")

# Dollars Problem Setup

print()
print(f"Company:\t\tSales ($)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t${my_sales_dollars}\t\t{my_ms_dollars:.2f}%")
print(f"Company B:\t\t??\t\t{competitor_ms_dollars:.2f}%")
print(f"Lead Competitor:\t??\t\t{lead_ms_dollars:.2f}%")
print(f"Market Size ($):\t??\t\t100%")
print()

# Company B Sales Dollars
user_competitor_sales_dollars = int(input("Enter Company B's Total Sales to the nearest dollar: $"))

if user_competitor_sales_dollars == competitor_sales_dollars:
    print(f"Correct! The total sales of Company B was this year is ${competitor_sales_dollars}.")
else:
    print("Try again.")
    user_competitor_sales_dollars = int(input("Enter Company B's Total Sales to the nearest dollar: $"))
    if user_competitor_sales_dollars == competitor_sales_dollars:
        print(f"Correct! The total sales of Company B was this year is ${competitor_sales_dollars}.")
    else:
        print("Try again. Last try.")
        user_competitor_sales_dollars = int(input("Enter Company B's Total Sales to the nearest dollar: $"))
        if user_competitor_sales_dollars == competitor_sales_dollars:
            print(f"Correct! The total sales of Company B was this year is ${competitor_sales_dollars}.")
        else:
            print(f"The correct Company B's Sales in dollars was ${competitor_sales_dollars:.3f} (3 decimals for you to check your rounding).")
            print("Divide Your Company's sales in dollars by the percent market share to figure out how many $ = 1% market share. ")
            print("Multiply this number by the percent of Company B to find Company B's Sales in dollars.")
            print(f"In this case, that will be {my_sales_dollars} / {my_ms_dollars} * {competitor_ms_dollars:.3f}.")

print()
print("Updated Version of the Question:")
print()
print(f"Company:\t\tSales ($)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t${my_sales_dollars}\t\t{my_ms_dollars:.2f}%")
print(f"Company B:\t\t{competitor_sales_dollars}\t\t{competitor_ms_dollars:.2f}%")
print(f"Lead Competitor:\t??\t\t{lead_ms_dollars:.2f}%")
print(f"Market Size ($):\t??\t\t100%")
print()

# Lead Competitor Sales Dollars

user_lead_sales_dollars = int(input("Enter the Lead Competitor's Total Sales to the nearest dollar: $"))

if user_lead_sales_dollars == lead_sales_dollars:
    print(f"Correct! The total sales of the Lead Competitor was this year is ${lead_sales_dollars}.")
else:
    print("Try again.")
    user_lead_sales_dollars = int(input("Enter the Lead Competitor's Total Sales to the nearest dollar: $"))
    if user_lead_sales_dollars == lead_sales_dollars:
        print(f"Correct! The total sales of the Lead Competitor was this year is ${lead_sales_dollars}.")
    else:
        print("Try again. Last try.")
        user_lead_sales_dollars = int(input("Enter the Lead Competitor's Total Sales to the nearest dollar: $"))
        if user_lead_sales_dollars == lead_sales_dollars:
            print(f"Correct! The total sales of the Lead Competitor was this year is ${lead_sales_dollars}.")
        else:
            print(f"The correct sales in dollars of the Lead Competitor was ${lead_sales_dollars} (3 decimals for you to check your rounding).")
            print("Divide Your Company's sales in dollars by the percent market share to figure out how many $ = 1% market share. ")
            print("Multiply this number by the percent of Company B to find Company B's Sales in dollars.")
            print(f"In this case, that will be {my_sales_dollars} / {my_ms_dollars} * {lead_ms_dollars:}.")

print()
print("Updated Version of the Question:")
print()
print(f"Company:\t\tSales ($)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t${my_sales_dollars}\t\t{my_ms_dollars:.2f}%")
print(f"Company B:\t\t{competitor_sales_dollars}\t\t{competitor_ms_dollars:.2f}%")
print(f"Lead Competitor:\t{lead_sales_dollars}\t\t{lead_ms_dollars:.2f}%")
print(f"Market Size ($):\t??\t\t100%")
print()

# Market Size

user_total_sales = int(input("Input the market size: $"))

if user_total_sales == total_sales_dollars:
    print(f"Correct! The market size of the industry in dollars for this year is ${total_sales_dollars}.")
else:
    print("Try again.")
    user_total_sales = float(input("$"))
    if user_total_sales == total_sales_dollars:
        print(f"Correct! The market size of the industry in dollars for this year is ${total_sales_dollars}.")
    else:
        print("Try again. Last try.")
        user_total_sales = float(input("$"))
        if user_total_sales == total_sales_dollars:
            print(f"Correct! The market size of the industry in dollars for this year is ${total_sales_dollars}.")
        else:
            print(f"The correct market size was ${total_sales_dollars}.")
            print(f"This is Your Company's sales {my_sales_dollars} + Company B's Sales {competitor_sales_dollars} + Lead Competitor's Sales {lead_sales_dollars}")

print()
print("Completed Version of the Question:")
print()
print(f"Company:\t\tSales ($)\tMarket Share %")
print("_" * 50)
print(f"Your Company:\t\t${my_sales_dollars}\t\t{my_ms_dollars:.2f}%")
print(f"Company B:\t\t{competitor_sales_dollars}\t\t{competitor_ms_dollars:.2f}%")
print(f"Lead Competitor:\t{lead_sales_dollars}\t\t{lead_ms_dollars:.2f}%")
print(f"Market Size ($):\t{total_sales_dollars}\t\t100%")
print()
print("Good job!")
