
print(f"Welcome to Long Answer Market Share and Market Size\n")

global completion

import random

class CompanyInfo:

    def __init__(self, lower_sales_units, upper_sales_units, price_lower, price_higher):
        self.sales_units = random.randint(lower_sales_units, upper_sales_units)
        self.selling_price = random.randint(price_lower, price_higher)
        self.sales_dollars = self.sales_units * self.selling_price

my_company = CompanyInfo(50000, 100000, 2, 10)
lead_competition = CompanyInfo(200000, 400000, 6, 18)
competitor = CompanyInfo(8000, 20000, 2, 10)

# Useful Randomized Sign Function
def random_sign(value):
    plus_minus = random.randint(0,1)
    if plus_minus == 0:
        value = -value
    return value

change_in_sales = random_sign(random.randint(1000, 100000))

class TotalInfo:
    def __init__(self):
        self.sales_units = my_company.sales_units + lead_competition.sales_units + competitor.sales_units
        self.sales_dollars = my_company.sales_dollars + lead_competition.sales_dollars + competitor.sales_dollars
        self.last_year_sales = self.sales_dollars + change_in_sales
        self.market_growth_rate = ((self.sales_dollars - last_year_sales) / last_year_sales) * 100

total = TotalInfo()

class Segment:
    def __init__(self, percent):
        self.percent = percent
        self.dollars = self.percent * total.sales_dollars

segment_a = Segment(random.randint(50,99))
segment_b = Segment(100 - segment_a.percent)

class ProblemAnswers:
    def __init__(self, class_name, chosen_segment=segment_a):
        self.rel_ms = class_name.sales_dollars / lead_competition.sales_dollars * 100
        self.ms_dollars = class_name.sales_dollars / total.sales_dollars * 100
        self.ms_units = class_name.sales_units / total.sales_units * 100
        self.ms_seg = class_name.sales_dollars / chosen_segment.dollars * 100

my_answers = ProblemAnswers(my_company)
competitor_answers = ProblemAnswers(competitor)
lead_answers = ProblemAnswers(lead_competition)

# Relative Market Share # Didn't change because I'm just cleaning up back end code.
print(f"Company:\t\tSales in dollars ($)")
print("_" * 50)
print(f"You:\t\t\t${my_company.sales_dollars:,d}")
print(f"Company B:\t\t${competitor.sales_dollars:,d}")
print(f"Lead Competitor:\t${lead_competition.sales_dollars:,d}")

# Create appropriate exception classes for common input errors.
class CommaError(Exception):
    def __init__(self, value):
        self.value = value

class DollarSignError(Exception):
    def __init__(self, value):
        self.value = value

class PercentError(Exception):
    def __init__(self, value):
        self.value = value

# General function to safely handle user input so the program does not break so easily.
def get_user_input(print_message, float_or_int):
    print(print_message, end="")
    user_input = input()
    while user_input != "give up":
        try:
            if "," in user_input:
                raise CommaError("Invalid input. Do not enter the , sign")
            if "%" in user_input:
                raise PercentError("Invalid input. Do not enter the % sign.")
            if "$" in user_input:
                raise DollarSignError("Invalid Input. Do not enter the $ sign.")
            user_input = float_or_int(user_input)
            return user_input
            break

        except CommaError as excpt:
              print(excpt)
              user_input = input()
        except PercentError as excpt:
              print(excpt)
              user_input = input()
        except DollarSignError as excpt:
              print(excpt)
              user_input = input()
        except:
              print("Invalid Entry.")
              user_input = input()
    if user_input == "give up":
        return "give up"

# General class to group and print answer messages as created by instances.
class AnswerMessages:
    company_class = None
    ans_class = None
    company_name = None
    def __init__(self):
        self.correct = None
        self.input_precursor = ""
        self.try_again = "Try again or enter \"give up\" to show the answer: {self.input_precursor}"
        self.wrong = None
    def print_msg(self, msg):
        if msg == 1:
            print(self.correct)
        if msg == 2:
            print(self.try_again)
        if msg == 3:
            print()
            print(self.wrong)

# Functions to check float and int values.

def check_float_value(user_val, value_to_check, instance_name):
    global completion
    value_low = value_to_check - 0.005
    value_high = value_to_check + 0.005
    if user_val == "give up":
        instance_name.print_msg(3)
        completion = True
    elif value_low < user_val < value_high:
        instance_name.print_msg(1)
        completion = True
    else:
        instance_name.print_msg(2)

def check_exact_value(user_val, value_to_check, instance_name):
    if user_val == "give up":
        instance_name.print_msg(3)
        completion = True
    elif user_val == value_to_check
        instance_name.print_msg(1)
        completion = True
    else:
        instance_name.print_msg(2)

# Missing Value Market Share and Size

class LongQuestion:
    def __init__(self):
        self.count = 0
        self.question_type = "" # ASSIGN THIS OUTSIDE
        self.show_middle_top, self.show_middle_middle, self.show_middle_bottom, self.show_right_top, self.show_right_middle, \
             self.show_right_bottom, self.show_market_size = False
        self.construction_list = [[my_company, competitor, lead_competition], [my_answers, competitor_answers, lead_answers]]
        self.market_size = total.market_size

    def assign_answer_vals(self):
        if self.question_type == "units":
            # This function does THIS
            value_list = [i.sales_units for i in self.construction_list[0]]
            value_list.extend([i.ms_units for i in self.construction_list[1]])
            self.middle_top, self.middle_middle, self.middle_bottom, self.right_top, self.right_middle, self.right_bottom = tuple(value_list)
        if self.question_type == "dollars":
            value_list = [i.sales_dollars for i in self.construction_list[0]]
            value_list.extend([i.ms_dollars for i in self.construction_list[1]])
            self.middle_top, self.middle_middle, self.middle_bottom, self.right_top, self.right_middle, self.right_bottom = tuple(value_list)
    
    def print_question_header(self):
        if count == 4:
            print()
            print("Completed version of the question:")
        elif count > 0:
            print()
            print("Updated version of the question:")

    def get_var(self, show_var, val):
        if self.show_var == True:
            return f"val:.2f"
        else:
            return "??"

    def print_table_header(self):
        print()
        print(f"Company:\t\tSales ({self.question_type})\tMarket Share %")
        print("_" * 50)

    def print_question(self): # Fix this up later
        self.print_question_header()
        self.print_table_header()
        print(f"Your Company:\t\t{self.get_var(self.show_middle_top, self.middle_top)}\t\t{self.get_var(show_right_top, self.right_top)}%")
        print(f"Company B:\t\t{self.get_var(self.show_middle_middle, self.middle_middle)}\t\t{self.get_var(self.show_right_middle, self.right_middle)}%")
        print(f"Lead Competitor:\t{self.get_var(self.show_middle_bottom, self.middle_bottom)}\t\t{self.get_var(self.show_right_bottom, self.right_bottom)}%")
        print(f"Market Size ({self.question_type}):\t{self.get_var(self.show_market_size, self.market_size)}\t\t100%")

# Set Up Answer Messages for Market Size Question
market_size_units = AnswerMessages()
market_size_units.correct = f"Correct. The market size in units is {market_size_units} units.\n"
market_size_units.wrong = f"The correct market size in units was {market_size_units} units.\n" \
            f"Add Your Company's sales in units to Company B's sales in Units to the Lead Competitor's sales in units.\n" \
            f"In this case, that will be {my_company.sales_units} + {competitor.sales_units} * {lead_competition.sales_units}.\n"

long_question = LongQuestion()
long_question.question_type = "units"
long_question.show_middle_top = True
long_question.show_middle_middle = True
long_question.show_middle_bottom = True
long_question.print_question()

print()
print("Assume only you, company B, and the lead competitor are in this industry.")
completion = False
while completion == False:
    user_market_size_units = get_user_input("Enter the total market size in units here: ", int)
    check_exact_value(user_market_size_units, total.sales_units, market_size_units)

long_question.count += 1
long_question.show_market_size = True
long_question.print_question()

# Set up your comapny's market share answer messages.
my_ms_units = AnswerMessages()
my_ms_units.correct = f"Correct! Your Company's Market Share is {my_ms_units:.3f}% (3 decimal places for reference)."
my_ms_units.wrong = f"The correct Market Share in units for Your Company was {my_answers.ms_units:.3f}% rounded up or down as necessary.\n" \
              f"The Market Share of Your Company is your sales in units divided by total sales in units.\n" \
              f"In this case, that is {my_company.sales_units} / {total.sales_units} * 100 to convert to a percent.\n"

# Find your company's market share.
completion = False
while completion == False:
    user_my_ms_units = get_user_input("Enter YOUR company's market share in units as a percentage up to 2 decimal places: ", float)
    check_float_value(user_my_ms_units, my_answers.ms_units, my_ms_units)

# Increment Count, Update Question, and Print
long_question.count += 1
long_question.show_right_top = True
long_question.print_question()

# Company B Market Share Answer Messages Set Up
competitor_ms_units = AnswerMessages()
competitor_ms_units.correct = f"Correct! Company B's Market Share is {competitor_answers.ms_units:.2f}%."
competitor_ms_units.wrong = f"The correct Market Share in units for Company B was {competitor_answers.ms_units:.2f}%.\n" \
              f"The Market Share of Company B is Company B's sales in units divided by total sales in units.\n" \
              f"In this case, that is {competitor.sales_units} / {total.ms_units} * 100 to convert to a percent."

# Company B Market Share Question
print()
completion = False
while completion = False:
        user_competitor_ms_units = get_user_input("Enter Company B's market share in units as a percentage up to 2 decimal places: ", float)
        check_float_value(user_competitor_ms_units, competitor_answers.ms_units, competitor_ms_units)

# Update Long Question after Company B
long_question.count += 1
long_question.show_right_middle = True
long_question.print_question()

# Lead Competitor Market Share Answer Messages
lead_ms_units = AnswerMessages()
lead_ms_units.correct = f"Correct! The Lead Competitor's Market Share is {lead_answers.ms_units:.2f}%"
lead_ms_units.wrong = f"The correct Market Share in units for the Lead Competitor was {lead_answers.ms_units:.2f}%\n" \
              f"The Market Share of the Lead Competitor is the Lead Competitor's sales in units divided by total sales in units.\n" \
              f"In this case, that is {lead_competition.sales_units} / {total.ms_units} * 100 to convert to a percent."

# Lead Competitor Market Share Question
print()
completion = False
while completion = False:
    user_lead_ms_units = float(input("Enter the Lead Competitor's market share in units as a percentage up to 2 decimal places: "))
    check_float_value(user_lead_ms_units, lead_competition_answers.ms_units, lead_ms_units)

# Complete Long Question Printing.
long_question.count += 1
long_question.show_right_bottom = True
long_question.print_question()
print("Good job! Now, on to the dollars Market Share Simulation!")

# Dollars Problem Setup
long_question2 = LongQuestion()
long_question2.question_type = "units"
long_question2.show_middle_top, long_question2.show_right_top = True
long_question2.show_right_middle, long_question2.show_right_bottom = True
long_question2.print_question()

# Company B Sales Dollars Setting Up Answer Messages
competitor_sales_dollars = AnswerMessages()
competitor_sales_dollars.correct = f"Correct! The total sales of Company B was this year is ${competitor.sales_dollars}."
competitor_sales_dollars.wrong = f"The total sales of Company B this year was ${competitor.sales_dollars}.\n" \
        f"Divide Your Company's sales in dollars by the percent market share to figure out how many $ = 1% market share.\n" \
        f"Multiply this number by the percent of Company B to find Company B's Sales in dollars.\n" \
        f"In this case, that will be {my_company.sales_dollars} / {my_answers.ms_dollars:.2f} * {competitor_answers.ms_dollars:.2f}."

# Company B Sales Dollars Question
completion = False
while completion == False:
    user_competitor_sales_dollars = get_user_input("Enter Company B's Total Sales to the nearest dollar: $", int)
    check_exact_value(user_competitor_sales_dollars, competitor.sales_dollars, competitor_sales_dollars)

# Update the question class, show values, print.
long_question2.count += 1
long_question2.show_right_middle = True
long_question2.print_question

# Set up Lead Competitor Sales Dollars Answers
lead_competition_sales_dollars = AnswerMessages()
lead_competition_sales_dollars.correct = f"Correct! The total sales of the Lead Competitor was this year is ${lead_competitor.sales_dollars}."
lead_competition_sales_dollars.wrong = f"The correct sales in dollars of the Lead Competitor was ${lead_competitor.sales_dollars:.2f}\n." \
            f"Divide Your Company's sales in dollars by the percent market share to figure out how many $ = 1% market share.\n" \
            f"Multiply this number by the percent of Lead Competitor to find Lead Competitor's Sales in dollars.\n" \
            f"In this case, that will be {my_company.sales_dollars} / {my_answers.ms_dollars} * {lead_answers.ms_dollars:}."

# Lead Competitor Sales Dollars Question
completion = False
while completion == False:
    user_lead_sales_dollars = int(input("Enter the Lead Competitor's Total Sales to the nearest dollar: $"))
    check_exact_value(user_lead_sales_dollars, lead_competition.sales_dollars, lead_competition_sales_dollars)

# Update the question class, counter.
long_question2.count += 1
long_question2.show_bottom_right = True
long_question2.print_question()


# Market Size Answer Messages set Up
total_sales = AnswerMessages()
total_sales.correct = f"Correct! The market size of the industry in dollars for this year is ${total.sales_dollars}."
total_sales.wrong = f"The correct market size was ${total.sales_dollars}.\n" \
            f"This is Your Company's sales {my_company.sales_dollars} + Company B's Sales {competitor.sales_dollars} + Lead Competitor's Sales {lead_competition.sales_dollars}"

# Market Size Question Final
completion = False
while completion == False:
    user_total_sales = get_user_input("Input the market size: $", int)
    check_exact_value(user_total_sales, total.sales_dollars, total_sales)
long_question2.count += 1
long_question2.show_# FIND ME WHAT DO I SHOW??????
long_qestion2.print_question()
print("Good job! All done with Market Share Long Answer Questions!")
