print("Welcome to Break Even Analysis Practice")

import random
import math

# Intialize class Unit to store unit probolem values.
class Unit():
    def __init__(self):
        self.vc = round(random.uniform(2, 100), 2)
        self.profit = round(random.randint(1, 15), 2)
        self.fc = round(random.randint(1, 15), 2)
        self.selling_price = round(self.vc + self.fc + self.profit, 2)

# Initialize Class Total to store total problem values.
class Total():
    def __init__(self, unit_instance):
        self.expected_sales = random.randint(1000, 300000)
        self.total_fc = round(unit_instance.fc * self.expected_sales, 2)
        self.total_revenue = round(unit_instance.selling_price * self.expected_sales)
        # Market size must be greater than or equal to the revenue of the company thus the multiplication by a
        # Random number between 1 and 1000 to create the market size from the company's revenue.
        self.market_size = round((random.uniform(1,1000) * self.total_revenue), 2)

# Intialize class to store problem answers.
class ProblemAnswers():
    def __init__(self, unit_instance, total_instance):
        self.be_units_raw = total_instance.fc / (unit_instance.selling_price - unit_instance.vc)
        self.be_units = math.ceil(self.be_units_raw)
        self.be_dollars = round(self.be_units * unit_instance.selling_price, 2)
        self.be_ms = self.be_dollars / total_instance.market_size
        self.be_selling_price = round(total_instance.fc / total_instance.expected_sales + unit.vc, 2) 
        # Should be equal to unit_instance.selling_price but to prevent any rounding issues the math is done here.

# Set up for first half of the problems.

unit = Unit()
total = Total(unit)
answer = ProblemAnswers(unit, total)

print()
print("Values to be used in the Break Even UNITS problem:")
print(f"Unit Variable Cost: ${unit.vc}\nTotal Fixed Cost: ${total.fc}")
print(f"Unit Selling Price: ${unit.selling_price}")

# Break Even Units Question Setup

print()

be_units = AnswerMessages()
be_units.correct = f"Correct! The Break Even number is {answer.be_units} units."
be_units.wrong = f"The correct Break Even number was {answer.be_units_raw:.1f} units rounded up to a whole number.\n" \
              print(f"The break even number is total fixed costs / unit selling price - variable costs per unit.\n" \
              print(f"This means ${total.fc} / {unit.selling_price} + ${unit.vc} in this case."

# Break Even Units Question

completion = False
while completion == False:
    user_be_units = get_user_input("Enter the number of units the company must sell to break even (round up to whole number): ", int)
    check_exact_value(user_be_units, answer.be_units, be_units)

# Set up Break Even Units in Total Dollars

print()

be_dollars = AnswerMessages()
be_dollars.precursor = "$"
be_dollars.correct = f"Correct! The Break Even total revenue is ${answer.be_dollars:.2f}."
be_dollars.wrong = f"The correct Break Even total revenue was ${answer.be_dollars:.2f}.\n" \
              f"Break even total revenue is Break Even Units * Selling Price of each unit.\n" \
              f"This means ${answer.be_units} * ${unit.selling_price} in this case.")

# Break Even Dollars Question

completion = False
while completion == False:
    user_be_dollars = get_user_input("Enter the total amount of sales revenue that the company needs to breakeven: $", float)
    check_float_value(user_be_dollars, answer.be_dollars, be_dollars)

# Break Even Market Share Question Set Up

print()
print(f"Assume that the total market size is ${total.market_size:.2f}")
be_ms = AnswerMessages()
be_ms.correct = f"Correct! The Break Even market share is {answer.be_ms:.2f}%."
be_ms.wrong = f"The correct Break Even market share was {answer.be_ms:.2f}%.\n" \
              f"Break even selling price is Break Even Sales Revenue / Total Market Sales.\n" \
              f"This means ${answer.be_dollars:.2f} / ${total.market_size:.2f} in this case."

completion = False
while completion == False:
    user_be_ms = get_float_input("Input the market share the company needs to capture to break even as a percentage: ", float)
    check_float_value(user_be_ms, answer.be_ms, be_ms)

# Set up for Final Break Even Pricing Problem and change numbers.

print()

unit2 = Unit()
total2 = Total(unit2)
answers2 = ProblemAnswers(unit2, total2)

print("Values to be used in the Break Even PRICING problem:")
print(f"Unit Variable Cost: ${unit2.vc}\nTotal Fixed Cost: ${total2.fc}")
print(f"Units sold: {unit2.expected_sales}")

# Find break-even selling price

print()

be_selling_price = AnswerMessages()
be_selling_price.precursor = "$"
be_selling_price.correct = f"Correct! The Break Even selling price is ${answer2.be_selling_price:.2f}."
be_selling_price.wrong = f"The correct Break Even selling price per unit was ${answer2.be_selling_price:.2f}.\n" \
              f"Break even selling price is total fixed costs / expected sales + variable costs per unit.\n" \
              f"This means ${total2.fc} / {unit2.expected_sales} + ${unit2.vc} in this case."

completion = False
while completion == False:
    user_selling_price = get_user_input("Enter the price at which the company must sell to break even (round to 2 decimals): $", float)
    check_float_value(user_selling_price, answer2.be_selling_price, be_selling_price)
