print("Welcome to Contribution Margin and Profit Contribution Practice")

import random

# Initialize class Unit to generate and store the unit-related variables of the problem.
class Unit:
    def __init__(self):
        self.vc = round(random.uniform(2, 100), 2)
        self.profit = round(random.uniform(1, 15), 2)
        self.fc = round(random.uniform(1, 15), 2)
        self.selling_price = unit_vc + unit_fc + unit_profit
        self.dollar_cm = self.selling_price - self.vc
        self.percent_cm = self.dollar_cm / self.selling_price * 100
        self.dollar_pc = self.cm - self.fc

# Initialize class Total to store the Total related variables in the problem.
class Total:
    def __init__(self):
        self.expected_sales = random.randint(100, 1000)
        self.cm = unit.cm * self.expected_sales
        self.pc = unit.pc * self.expected_sales

# Create appropriate exception classes for common input errors.
class CommaError(Exception):
    def __init__(self, value):
        self.value = value

class DollarSignError(Exception):
    def __init__(self, value):
        self.value = value

class PercentError(Exception):
    def __init__(self, value):
        self.value = value

# General function to safely handle user input so the program does not break so easily.
def get_user_input(print_message, float_or_int):
    print(print_message, end="")
    user_input = input()
    while user_input != "give up":
        try:
            if "," in user_input:
                raise CommaError("Invalid input. Do not enter the , sign")
            if "%" in user_input:
                raise PercentError("Invalid input. Do not enter the % sign.")
            if "$" in user_input:
                raise DollarSignError("Invalid Input. Do not enter the $ sign.")
            user_input = float_or_int(user_input)
            return user_input
            break

        except CommaError as excpt:
              print(excpt)
              user_input = input()
        except PercentError as excpt:
              print(excpt)
              user_input = input()
        except DollarSignError as excpt:
              print(excpt)
              user_input = input()
        except:
              print("Invalid Entry.")
              user_input = input()
    if user_input == "give up":
        return "give up"

# General class to group and print answer messages as created by instances.
class AnswerMessages:
    def __init__(self):
        self.correct = None
        self.input_precursor = ""
        self.try_again = f"\nTry again or enter \"give up\" to show the answer: {self.input_precursor}"
        self.wrong = None
    def print_msg(self, msg):
        if msg == 1:
            print(self.correct)
        if msg == 2:
            print(self.try_again)
        if msg == 3:
            print()
            print(self.wrong)

# Functions to check float and int values.

def check_float_value(user_val, value_to_check, instance_name):
    global completion
    value_low = value_to_check - 0.005
    value_high = value_to_check + 0.005
    if user_val == "give up":
        instance_name.print_msg(3)
        completion = True
    elif value_low < user_val < value_high:
        instance_name.print_msg(1)
        completion = True
    else:
        instance_name.print_msg(2)

def check_exact_value(user_val, value_to_check, instance_name):
    global completion
    if user_val == "give up":
        instance_name.print_msg(3)
        completion = True
    elif user_val == value_to_check:
        instance_name.print_msg(1)
        completion = True
    else:
        instance_name.print_msg(2)

print("Values to be used in the problem:")
print(f"Unit Variable Cost: ${unit_vc}\nTotal Fixed Cost: ${total_fc}")
print(f"Unit Selling Price: ${selling_price}\nExpected Sales: {expected_sales} units")

completion = False
while completion == False:
    user_unit_cm = get_user_input("Enter the CM per unit in $ as a decimal up to 2 places: $", float)
    check_float_value(user_unit_cm)

unit_cm = AnswerMessages()
unit_cm.correct = f"Correct! The CM per unit is ${unit_cm:.2f}."\
unit_cm.wrong = f"The correct CM per unit was ${unit_cm:.3f} rounded up or down as necessary.\n" \
              print(f"Contributed margin is unit selling price - unit variable costs.")
              print(f"This means ${selling_price} - ${unit_vc} = ${unit_cm:.3f} in this case.")
#REVISIONS RGIHT ABVOVE< MOVE answer mesages up.

#Percent Contributed Margin
print()
user_percent_cm = float(input("Enter the CM as a percent (DO NOT ENTER % THOUGH) up to 2 decimal places: "))

percent_cm_low = percent_cm - 0.005
percent_cm_high = percent_cm + 0.005

if percent_cm_low < user_percent_cm < percent_cm_high:
    print(f"Correct! The percent CM is {percent_cm:.3f}% (3 decimal places for reference).")
else:
    print("Try again.")
    user_percent_cm = float(input())
    if (percent_cm - 0.006) < user_percent_cm < (percent_cm + 0.006):
        print(f"Correct! The percent CM is {percent_cm:.3f}% (3 decimal places for reference).")
    else:
         print("Try again. Last try.")
         user_percent_cm = float(input())
         if (percent_cm - 0.006) < user_percent_cm < (percent_cm + 0.006):
              print(f"Correct! The percent CM is {percent_cm:.3f}% with less rounding for reference.")
         else:
              print(f"The correct percent CM was {percent_cm:.3f}% rounded up or down as necessary.")

# Profit Contribution
print()
user_profit_contribution = float(input("Enter the PC per unit as a decimal up to 2 places: $"))

profit_contribution_low = profit_contribution - 0.005
profit_contribution_high = profit_contribution + 0.005

if profit_contribution_low < user_profit_contribution < profit_contribution_high:
    print(f"Correct! The profit contribution is ${profit_contribution:.3f} (3 decimal digits as a reference).")
else:
    print("Try again.")
    user_profit_contribution = float(input())
    if profit_contribution_low < user_profit_contribution < profit_contribution_high:
            print(f"Correct! The profit contribution is ${profit_contribution:.3f} (3 decimal digits as a reference).")
    else:
         print("Try again. Last try.")
         user_profit_contribution = float(input())
         if profit_contribution_low < user_profit_contribution < profit_contribution_high:
              print(f"Correct! The profit contribution is ${profit_contribution:.3f} (3 decimal digits as a reference).")
         else:
              print(f"The correct profit contribution was ${profit_contribution:.3f} rounded up or down as necessary.")
              print(f"Profit contribution is (unit selling price - unit variable costs - fixed costs per unit.")
              print("Fixed costs per unit are total fixed costs / expected number of units sold.")
              print(f"This means {selling_price} - {unit_vc} - {unit_fc} in this case.")

# Total Contributed Margin
print()
user_total_cm = float(input("Enter the total CM as a decimal up to 2 places: $"))

total_cm_low = total_cm - 0.005
total_cm_high = total_cm + 0.005

if total_cm_low < user_total_cm < total_cm_high:
    print(f"Correct! The total CM is ${total_cm:.3f} (3 decimal places for reference).")
else:
    print("Try again.")
    user_total_cm = float(input())
    if total_cm_low < user_total_cm < total_cm_high:
         print(f"Correct! The total CM is ${total_cm:.3f} (3 decimal places for reference).")
    else:
         print("Try again. Last try.")
         user_total_cm = float(input())
         if total_cm_low < user_total_cm < total_cm_high:
              print(f"Correct! The total CM is ${total_cm:.3f} (3 decimal places for reference).")
         else:
              print(f"The correct total CM was ${total_cm:.3f} rounded up or down as necessary.")
              print(f"Total contributed margin is unit ontributed margin * expected sales in this case.")
              print(f"This means ${unit_cm} * {expected_sales} in this case.")

# Total Profit Contribution
print()
user_total_pc = float(input("Enter the total PC as a decimal up to 2 places: $"))

total_pc_low = total_pc - 0.005
total_pc_high = total_pc + 0.005

if total_pc_low < user_total_pc < total_pc_high:
    print(f"Correct! The total PC is ${total_pc:.3f} (3 decimal places for reference).")
else:
    print("Try again.")
    user_total_pc = float(input())
    if total_pc_low < user_total_pc < total_pc_high:
         print(f"Correct! The total PC is ${total_pc:.3f} (3 decimal places for reference).")
    else:
         print("Try again. Last try.")
         user_total_pc = float(input())
         if total_pc_low < user_total_pc < total_pc_high:
              print(f"Correct! The total PC is ${total_pc:.3f} (3 decimal places for reference).")
         else:
              print(f"The correct total PR was ${total_pc:.3f} rounded up or down as necessary.")
              print(f"Total contributed margin is unit ontributed margin * expected sales in this case.")
              print(f"This means ${unit_pc} * {expected_sales} in this case.")
